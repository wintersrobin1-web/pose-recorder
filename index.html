<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MOTAXIS - Anonyme Bewegungsanalyse</title>

<style>
:root{
  --bg: #bfe7ff;
  --ink: #0f172a;
  --muted: #475569;
  --card: #ffffff;
  --border: #e5e7eb;

  --introBg: #f8fafc;
  --introBorder: #e2e8f0;
  --accent: #111827;
}

body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  margin: 16px;
  color: var(--ink);
  background: #fff;
}

.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
.hint { color: var(--muted); font-size: 14px; line-height: 1.45; max-width: 1100px; }

.header{
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 14px 14px 12px 14px;
  margin-bottom: 12px;
  background: var(--card);
  max-width: 1100px;
}
.brand{ display:flex; flex-direction:column; gap: 2px; margin-bottom: 10px; }
.brand .logo{
  font-weight: 900; letter-spacing: 1.6px; font-size: 26px; line-height: 1.05;
  text-transform: uppercase; color: var(--accent);
}
.brand .sub{ font-weight: 700; letter-spacing: 0.6px; font-size: 13px; color: #334155; text-transform: uppercase; }

.introBox{
  border: 1px solid var(--introBorder);
  border-radius: 14px;
  padding: 12px 14px;
  background: var(--introBg);
}
.introBox p{ margin: 0; color: #1f2a33; font-size: 13.75px; line-height: 1.45; text-align: left; }

.stack{
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  max-width: 1100px;
}

.block{
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px 12px;
  background: var(--card);
}
.blockTitle{ font-weight: 800; margin: 0 0 10px 0; font-size: 13px; color: #0b1220; }

details{
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px 12px;
  background: var(--card);
}
summary{ cursor: pointer; font-weight: 800; color: #0b1220; }

label{
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--card);
  font-size: 14px;
}
select{
  padding: 9px 12px;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  background: var(--card);
  font: inherit;
  color: #0b1220;
}

button{
  padding: 10px 14px;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  background: var(--card);
  font: inherit;
  color: #0b1220;
}
button.primary{ border-color: #0b1220; font-weight: 700; }
button:disabled{ opacity: 0.5; }

.btnRow{ display:flex; gap:10px; flex-wrap: wrap; }
.btnRow button{ flex: 1 1 auto; }
.btnRow .wide{ flex: 1 1 100%; }

video, canvas{
  max-width: 100%;
  border: 1px solid var(--border);
  border-radius: 10px;
}
video{ width: 360px; height: auto; background:#000; }
canvas{ width: 360px; height: auto; background: var(--bg); }

.videoHidden{
  width: 1px !important;
  height: 1px !important;
  opacity: 0 !important;
  position: absolute !important;
  left: -9999px !important;
  top: -9999px !important;
  pointer-events: none !important;
}

.rangeWrap{
  display:flex;
  align-items:center;
  gap:10px;
  padding: 8px 10px;
  border:1px solid var(--border);
  border-radius: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
  background: var(--card);
}
.rangeWrap span{ min-width: 170px; font-size: 13px; color:#475569; }
.small{ font-size: 13px; color:#475569; min-width: 64px; text-align:right; }

.tipsBox{
  margin-top: 10px;
  border: 2px solid #16a34a;
  border-radius: 12px;
  padding: 10px 12px;
  background: #f0fdf4;
  display: none;
  max-width: 1100px;
}
.tipsBox h3{ margin: 0 0 6px 0; font-size: 14px; }
.tipsBox ul{ margin: 6px 0 0 18px; padding: 0; }
.pill{
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid #bbf7d0;
  font-size: 12px;
  color: #14532d;
  background: #ecfdf5;
  margin-left: 6px;
}

.fbWrap{ display:flex; flex-direction:column; gap:10px; margin-top:10px; max-width: 820px; }
.fbRow{ display:flex; flex-direction:column; gap:6px; }
.fbRow input, .fbRow textarea{
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #cbd5e1;
  font: inherit;
  background: #fff;
  box-sizing: border-box;
}
.fbRow textarea{ min-height: 120px; resize: vertical; }
.fbFine{ font-size: 12.5px; color:#64748b; line-height:1.35; }
.fbStatus{ font-size: 13px; color:#334155; margin-top: 6px; display:none; }
.fbStatus.ok{ color: #0b6b0b; }
.fbStatus.err{ color: #a10000; }

#status{ margin-top: 12px; max-width: 1100px; }
</style>
</head>

<body>
<div class="header">
  <div class="brand">
    <div class="logo">MOTAXIS</div>
    <div class="sub">Anonyme Bewegungsanalyse</div>
  </div>
  <div class="introBox">
    <p>
      Beta-Version zur anonymen Aufnahme und Analyse von Skelettachsen und Bewegungen.
      Bislang optimiert für Brustschwimmen. Auswertungen sind experimentell und können je nach Aufnahmebedingungen variieren.
    </p>
  </div>
</div>

<video id="video" class="videoHidden" playsinline autoplay muted></video>

<div class="stack">

  <div class="block">
    <div class="blockTitle">Kamera</div>
    <div class="btnRow">
      <button id="btnInit" class="primary wide">Kamera aktivieren</button>
      <button id="btnSwitch" disabled class="wide">Kamera wechseln (Rück)</button>
    </div>
  </div>

  <details id="displayBox" open>
    <summary>Anzeige (allgemein)</summary>

    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <label><input type="checkbox" id="toggleSkeleton" checked /> Skelett</label>
      <label><input type="checkbox" id="toggleSilhouette" checked /> Segmentierung</label>

      <label style="border:none; padding:0; background:transparent;">
        <span style="font-weight:800; color:#0b1220;">Kameraperspektive</span>
      </label>

      <select id="filmingPreset" title="Kameraperspektive">
        <option value="side45" selected>Schräg seitlich (leicht von oben)</option>
        <option value="back45">Schräg von hinten (leicht von oben)</option>
        <option value="stand">Frontal (Stand)</option>
      </select>
    </div>

    <details id="advancedBox" style="margin-top:10px;">
      <summary>Erweiterte Einstellungen</summary>

      <div class="rangeWrap">
        <span>Input-Video anzeigen</span>
        <label style="border:none; padding:0; border-radius:0;">
          <input type="checkbox" id="showInputVideo" />
          <span class="small">anzeigen</span>
        </label>
        <span class="hint" style="max-width:none;">(Optional – Output bleibt anonym.)</span>
      </div>

      <div class="rangeWrap">
        <span>Segmentierung – Deckkraft</span>
        <input id="silOpacity" type="range" min="0" max="1" step="0.05" value="0.40">
        <span id="silOpacityVal" class="small">0.40</span>
      </div>

      <div class="rangeWrap">
        <span>Segmentierung – Schwelle</span>
        <input id="silThresh" type="range" min="0" max="100" step="1" value="70">
        <span id="silThreshVal" class="small">70</span>
      </div>

      <div class="rangeWrap">
        <span>Skelett – Linienstärke</span>
        <input id="skelLine" type="range" min="1" max="10" step="1" value="3">
        <span id="skelLineVal" class="small">3</span>
      </div>

      <div class="rangeWrap">
        <span>Skelett – Punkt-Radius</span>
        <input id="skelDot" type="range" min="1" max="10" step="1" value="4">
        <span id="skelDotVal" class="small">4</span>
      </div>

      <div class="rangeWrap">
        <span>Detection (min)</span>
        <input id="detConf" type="range" min="0.3" max="0.95" step="0.01" value="0.50">
        <span id="detVal" class="small">0.50</span>
      </div>

      <div class="rangeWrap">
        <span>Presence (min)</span>
        <input id="presConf" type="range" min="0.3" max="0.95" step="0.01" value="0.50">
        <span id="presVal" class="small">0.50</span>
      </div>

      <div class="rangeWrap">
        <span>Tracking (min)</span>
        <input id="trackConf" type="range" min="0.3" max="0.95" step="0.01" value="0.55">
        <span id="trackVal" class="small">0.55</span>
      </div>

      <div class="rangeWrap">
        <span>Glättung (EMA)</span>
        <input id="smooth" type="range" min="0" max="0.9" step="0.05" value="0.55">
        <span id="smoothVal" class="small">0.55</span>
      </div>

      <div class="rangeWrap">
        <span>HWS – Grün-Toleranz (°)</span>
        <input id="neckTol" type="range" min="6" max="35" step="1" value="14">
        <span id="neckTolVal" class="small">14</span>
      </div>

      <div class="rangeWrap">
        <span>HWS – Neutral-Offset (°)</span>
        <input id="neckNeutral" type="range" min="-10" max="25" step="1" value="12">
        <span id="neckNeutralVal" class="small">12</span>
      </div>

      <div class="rangeWrap">
        <span>HWS – Rot-Schwelle extra (°)</span>
        <input id="neckRedExtra" type="range" min="0" max="20" step="1" value="6">
        <span id="neckRedExtraVal" class="small">6</span>
      </div>

      <div class="rangeWrap">
        <span>HWS – Glättung (EMA)</span>
        <input id="neckEma" type="range" min="0.60" max="0.90" step="0.01" value="0.82">
        <span id="neckEmaVal" class="small">0.82</span>
      </div>

      <div class="rangeWrap">
        <span>HWS – Hold (ms)</span>
        <input id="neckHold" type="range" min="80" max="350" step="10" value="180">
        <span id="neckHoldVal" class="small">180</span>
      </div>

    </details>
  </details>

  <details id="breastTools">
    <summary>Brustschwimmen-Tools (spezifisch)</summary>

    <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
      <label><input type="checkbox" id="toggleNeck" checked /> HWS-Achse</label>
      <label><input type="checkbox" id="toggleLegCheck" checked /> Knie/Beine-Check</label>
      <label><input type="checkbox" id="toggleHandAxis" checked /> Hand-Achse (Armzug)</label>
      <label><input type="checkbox" id="toggleTimer" checked /> Timer – Gleitphase</label>
      <label><input type="checkbox" id="toggleHintBox" checked /> Techniktipps nach Stop</label>
    </div>
  </details>

  <div class="block">
    <div class="blockTitle">Aufnahme</div>
    <div class="btnRow">
      <button id="btnRec" disabled class="wide">Aufnahme starten</button>
      <button id="btnStop" disabled>Stop</button>
      <button id="btnShare" disabled>Teilen/Speichern</button>
      <button id="btnReset" disabled class="wide">Slots zurücksetzen</button>
    </div>
  </div>

  <div><canvas id="canvas"></canvas></div>

  <div id="tipsBox" class="tipsBox">
    <h3>Techniktipps Brustschwimmen <span id="hintMeta" class="pill"></span></h3>
    <div class="hint" id="hintText"></div>
    <ul id="hintList"></ul>
  </div>

  <details id="feedbackBox">
    <summary>Feedback / Fehler melden</summary>
    <div class="hint" style="margin-top:8px; max-width: 820px;">
      Wenn dir ein Fehler auffällt oder du eine sinnvolle Verbesserungsidee hast, schick sie hier ab.
    </div>

    <form
      id="feedbackForm"
      class="fbWrap"
      action="https://formspree.io/f/mzdbqzog"
      method="POST"
    >
      <div class="fbRow">
        <div class="fbFine">Deine E-Mail (optional)</div>
        <input type="email" name="email" placeholder="name@beispiel.de" autocomplete="email" />
      </div>

      <div class="fbRow">
        <div class="fbFine">Nachricht</div>
        <textarea name="message" placeholder="Was ist passiert? (Gerät/Browser, Aufnahmewinkel, Schritte zum Reproduzieren …)"></textarea>
      </div>

      <input type="hidden" name="app" value="MOTAXIS" />
      <input type="hidden" name="version" value="2026-02-03" />
      <input type="hidden" id="fbMeta" name="meta" value="" />

      <div class="btnRow" style="max-width: 420px;">
        <button id="btnFbSend" type="submit" class="primary">Senden</button>
      </div>

      <div id="fbStatus" class="fbStatus"></div>
    </form>
  </details>

</div>

<p class="hint mono" id="status">Status: bereit</p>

<!-- WICHTIG: JS als Modul aus Datei laden -->
<script type="module" src="./app.js"></script>
</body>
</html>
